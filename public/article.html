<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title id="article-title">Статья | АН ФАТТОРИЯ</title>
  <meta name="description" id="article-description" content="Статья о недвижимости">
  <meta property="og:title" id="og-title" content="Статья | АН ФАТТОРИЯ">
  <meta property="og:description" id="og-description" content="Статья о недвижимости">
  <meta property="og:image" id="og-image" content="">
  <meta property="og:url" id="og-url" content="">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- AOS CSS -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Основные стили -->
  <link rel="stylesheet" href="../css/main.css">
  <!-- Combined CSS -->
  <link rel="stylesheet" href="../css/index-combined.css">
</head>
<body>

<div id="header-placeholder"></div>

<!-- Контейнер для уведомлений -->
<div class="toast-container"></div>

<!-- Шапка статьи -->
<section class="page-header">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-6" data-aos="fade-right">
        <h1 id="article-title-header">Загрузка...</h1>
        <p class="lead" id="article-excerpt">Загрузка...</p>
        <div class="article-meta">
          <span id="article-category">Категория</span> |
          <span id="article-date">Дата</span> |
          <span id="article-views">Просмотры</span>
        </div>
      </div>
      <div class="col-md-6" data-aos="fade-left">
        <img id="article-image" src="" class="img-fluid rounded" alt="Статья" loading="lazy">
      </div>
    </div>
  </div>
</section>

<!-- Содержимое статьи -->
<section class="section">
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <div id="article-content">Загрузка статьи...</div>

        <!-- Социальные кнопки -->
        <div class="social-share mt-4">
          <h5>Поделиться статьей:</h5>
          <div class="d-flex gap-2">
            <a id="share-facebook" href="#" class="btn btn-outline-primary btn-sm" target="_blank">
              <i class="fab fa-facebook-f"></i> Facebook
            </a>
            <a id="share-twitter" href="#" class="btn btn-outline-info btn-sm" target="_blank">
              <i class="fab fa-twitter"></i> Twitter
            </a>
            <a id="share-vk" href="#" class="btn btn-outline-danger btn-sm" target="_blank">
              <i class="fab fa-vk"></i> VK
            </a>
            <a id="share-telegram" href="#" class="btn btn-outline-primary btn-sm" target="_blank">
              <i class="fab fa-telegram"></i> Telegram
            </a>
          </div>
        </div>

        <!-- Комментарии Disqus -->
        <div id="disqus_thread" class="mt-5"></div>
      </div>
      <div class="col-lg-4">
        <!-- Боковая панель -->
        <div class="sidebar">
          <h5>Категории</h5>
          <ul class="list-group list-group-flush" id="categories-list">
            <!-- Категории будут загружены динамически -->
          </ul>

          <h5 class="mt-4">Популярные статьи</h5>
          <div id="popular-articles">
            <!-- Популярные статьи -->
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div id="footer-placeholder"></div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
<!-- AOS JS -->
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js" defer></script>
<!-- Компонентный загрузчик -->
<script src="../js/load-components.js" defer></script>
<!-- Common JavaScript -->
<script src="../js/common.js" defer></script>
<!-- Forms JavaScript -->
<script src="../js/forms.js" defer></script>
<!-- Toast JavaScript -->
<script src="../js/toast.js" defer></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const slug = urlParams.get('slug');

  if (!slug) {
    document.getElementById('article-content').innerHTML = '<p>Статья не найдена.</p>';
    return;
  }

  // Загрузка статей
  fetch('../data/articles.json')
    .then(response => response.json())
    .then(articles => {
      const article = articles.find(a => a.slug === slug);

      if (!article) {
        document.getElementById('article-content').innerHTML = '<p>Статья не найдена.</p>';
        return;
      }

      // Заполнение мета-тегов
      document.title = article.title + ' | АН ФАТТОРИЯ';
      document.getElementById('article-title').textContent = article.title + ' | АН ФАТТОРИЯ';
      document.getElementById('article-description').content = article.excerpt;
      document.getElementById('og-title').content = article.title + ' | АН ФАТТОРИЯ';
      document.getElementById('og-description').content = article.excerpt;
      document.getElementById('og-image').content = article.image;
      document.getElementById('og-url').content = window.location.href;

      // Заполнение содержимого
      document.getElementById('article-title-header').textContent = article.title;
      document.getElementById('article-excerpt').textContent = article.excerpt;
      document.getElementById('article-category').textContent = article.category;
      document.getElementById('article-date').textContent = new Date(article.date).toLocaleDateString('ru-RU');
      document.getElementById('article-views').textContent = article.views + ' просмотров';
      document.getElementById('article-image').src = article.image;
      document.getElementById('article-content').innerHTML = article.content;

      // Социальные кнопки
      const url = encodeURIComponent(window.location.href);
      const title = encodeURIComponent(article.title);
      document.getElementById('share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
      document.getElementById('share-twitter').href = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
      document.getElementById('share-vk').href = `https://vk.com/share.php?url=${url}&title=${title}`;
      document.getElementById('share-telegram').href = `https://t.me/share/url?url=${url}&text=${title}`;

      // Загрузка категорий
      const categories = [...new Set(articles.map(a => a.category))];
      const categoriesList = document.getElementById('categories-list');
      categories.forEach(category => {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.innerHTML = `<a href="category.html?category=${encodeURIComponent(category)}">${category}</a>`;
        categoriesList.appendChild(li);
      });

      // Популярные статьи
      const popular = articles.sort((a, b) => b.views - a.views).slice(0, 5);
      const popularContainer = document.getElementById('popular-articles');
      popular.forEach(art => {
        const div = document.createElement('div');
        div.className = 'mb-3';
        div.innerHTML = `
          <a href="article.html?slug=${art.slug}" class="text-decoration-none">
            <h6>${art.title}</h6>
            <small class="text-muted">${art.views} просмотров</small>
          </a>
        `;
        popularContainer.appendChild(div);
      });

      // Disqus
      const disqus_config = function () {
        this.page.url = window.location.href;
        this.page.identifier = article.id;
      };

      (function() {
        const d = document, s = d.createElement('script');
        s.src = 'https://fattoria-by.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    })
    .catch(error => {
      console.error('Ошибка загрузки статьи:', error);
      document.getElementById('article-content').innerHTML = '<p>Ошибка загрузки статьи.</p>';
    });
});
</script>

</body>
</html>
